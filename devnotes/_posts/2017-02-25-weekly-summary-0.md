---
layout: post
title: Weekly Summary 0
date: 2017-02-25 22:00:00 +0900
tags: [markdown, remark, latex, npm, jest]
---

이제부터 주보를 작성 해보려고 한다.

매일 개발기록을 남기려하니 내용은 너무 얕고 주제도 불분명해지는 느낌이 들고, 그렇다고 제대로 쓰려하니 이미 하루 이상의 시간이 걸려버린다. 이런 내용을 매일같이 남기려고 하면 아마 이 블로그보다는 페이스북이나 다른 곳이 훨씬 나을 것이다.

하지만 매일의 기록을 남기는건 그만두고 싶지 않다. 매일 무엇을 했는지에 대해 평가와 반성이 필요하고 다음날을 더욱 철저하게 준비 할 수 있어야한다.

고로, 매주 토요일마다 모든 내용을 마무리하려고 한다.

또한, 일본어와 영어로 번역까지 하려고 한다. 먼저, 나의 일본어와 영어실력을 유지할 방법이 되기도하고, 5년간의 해외생활 때문에 외국인 지인이 한국인보다 더 많은 점도 있다. 그리고 영어는 아직 누가 있을지 잘 모르겠는데 일본어는 친구에게 첨삭을 부탁 할 수 있을 듯하다.

그럼 첫 걸음을 시작해보자.

## 2017-02-20

### Remark Math

토요일부터 Remark를 위한 수식 표현 플러그인을 만들고 있다. Remark Math라는 이름으로 `$`(인라인)와 `$$`(블록) 기호를 추가시키고 AST 파싱과 동시에 KaTeX등의 렌더러를 간단히 적용 할 수 있게 만들려고 한다. 일단 기본적인 코드는 완성되었고, 테스트를 통해 조금씩 디버그를 하고 있다. 덕분에 공부가 많이 되는 듯 하다.

만들땐 느끼지 못했는데, 어제부터 조금씩 테스트를 짜니 여러가지 문제가 다발적으로 나타났다.

먼저 블록 토크나이징에서 파라그래프 토크나이저가 `$$`를 인식 하지못하고 전부 단락내용으로 집어너어버리는 문제가 있었다. 이 부분의 규칙은 루프내부에 잠겨져 있었기에, 직접 플러그인으로 접근 할 수 없어서, 억지로 하면 파라그래프 토크나이저 자체를 다시써야 할 듯 했다. 그래서 이슈를 작성했는데 다행히 금방 픽스되었다.

> [wooorm/remark#232](https://github.com/wooorm/remark/issues/232)

또 다른문제로는 `$`와 `$$`의 병기문제이다. TeX의 기본 인라인은 `$`이지만 일부 패키지의 경우 `$$`도 인라인에서 사용하게 되는 경우가 있는 듯하다. 물론, 매스 블록이 `$$`을 칸막이로 사용하기에 겹칠 것같아 보이기도 하지만, 실제론 간섭되지 않고, 수식 표현을 지원하는 마크다운 플러그인도 `$`나 `$$` 둘중 하나를 지원하는게 많은 듯하다.

그리고 슈퍼팩토리얼(수식내 달러표시) `$\$$`라든가, 달러의 이스케이프처리 `\$\alpha\$`는 무난하게 수습되었고, 그외의 자잘한 문제는 대부분 문서상의 오류나 설명부족이 이어서 직접 코드를 보고 [wooorm/remark-html#14](https://github.com/wooorm/remark-html/pull/14)나 [wooorm/remark#231](https://github.com/wooorm/remark/pull/231)에 PR을 보냈다.

고로 남은 태스크는 다음과 같다.

- [wooorm/remark#232](https://github.com/wooorm/remark/issues/232) 반영
- Readme.md 작성
- 웹팩으로 컴파일된 예제 작성
- NPM으로 릴리즈
- Travis 설정
- Green keeper 설정

아마 내일 중으로 다 처리될 듯 하다. 힘내자.

그리고, 일이 다 끝나는데로 라이브러리 기획부터 디플로이까지에 대해 포스팅을 할 생각이다. 대충 목차는 다음과 같지 않을까...?

- 배경
  - Remark 설명
  - KaTeX 설명
- 설계
- 프로젝트 셋팅
  - 린터
  - 테스트
- 구현
  - 블록파서
  - 인라인파서
  - 통합 구현
- CI 설정
- 배포

### Remark 다양한 응용 구상

또한 Remark Math를 만들면서 Remark의 다양한 응용에 대해서도 한번 생각해보게 되었다.

#### VS Code

VS Code에는 기본 프리뷰 렌더러가 존재한다. 문제는 CommonMark 기반이라 GFM이랑은 다르다는 것이다. 물론 오토스크롤이 있지만, 내겐 그렇게 매력적이지 못한듯 하다.
아무래도 Remark를 기본 마크다운 렌더러로 사용가능한 플러그인이 필요할 듯 하다.
일단, 관련 플러그인이 이미 존재한다. [vscode-remark]라는 이름의 플러그인이고, 일단은 이것을 확장하는 쪽으로 시도해보는게 좋을 듯하다.

그리고 아마 아톰이나 서브라임 에디터처럼 다른 에디터로도 적용의 필요성이 생길것이다. 또한, 프리뷰에서 Charcoal을 통한 적용이 필요해질 수도 있다.

#### Editor

Charcoal에 다시금 고려하게 되었다. 나 혼자만을 위한 특정 룰을 만드는 것보다 [xo]처럼 Remark의 각종 옵션들을 맘대로 바꿀 수 있는 에디터로 만드는 편이 모두에게 기쁘게 될것이라 생각한다. 아마 그것을 위해 네이밍도 재고려 해야겠다. 일단 프로젝트명으로 Charcoal을 가지고 가고, 어느 정도 형태가 갖춰지면 wooorm에게 얘기를 해봐야겠다.

### [Jus][jus]로 블로그 엔진 변경을 검토

Jekyll이 루비로 쓰여져서 너무 불편하다. 내가 루비를 쓸 줄 모르는게 가장 큰 이유일건데 Kramdown의 백틱의 이스케이프처리가 GFM과 다르다. 분명 버그일건데 내가 손 쓸 방법도 없고 그렇게 반응이 빠른것 같지도 않다.

그리고 Jus가 매력적인건 깃허브 스태프인 [Zeke](zeke)가 리드 하고 있기도 하고, 깃허브 페이지로 간단히 디플로이 할 수 있는 부분까지 준비가 되어있다는 점이다.

하지만, Jus의 문제점은 마크다운 렌더러를 이미 [Marky markdown][marky-markdown]을 사용하고 있다는 점이다. NPM에 사용되는 만큼 좋아보이기도 하지만 기반인 Markdown-it이 AST를 지원하지도 않고, 컨샙이 이미 잡힌 프로젝트니 신택스를 바꾸는 PR은 아마 받아주지 않을 것이다. 하지만 안타깝게도 마크다운 파서를 바꿀 수 있게 만들어지지 않았다. 이에대해 [새 이슈](https://github.com/jus/jus/issues/57)를 추가했지만, Jus 또한 컨샙자체가 **Opinionated**를 지향하기 때문에 반영될 지는 미지수이다. 물론 마크다운을 렌더링하는 부분의 코드는 매우 단순하기 때문에 쉽게 해킹이 가능할 듯 하다.

### 라인 스티커 생성기

쉐어하우스의 쿠라타씨가 인감을 사용해서 라인 스티커를 만드는게 재밌어 보였다. 아마 이걸 활용해서 라인 스탬프를 생성하는 서비스를 만들 수 있을지않을까 하고 제안해보았다. 일단 긍정적인 답변을 받긴 했는데, 개인적으로 만들기도 쉽고 주목받기도 쉬울 듯 하지만 일본인으로서 어떤식으로 퍼뜨릴지 감이 안온다. 이 부분은 쿠라타씨에게 맡겨야 할 듯 한데, 다시 내일 한번 얘기를 해봐야 할듯 하다.

### 바벨에 대한 잡담

아직도 바벨을 그다지 안쓰는 사람들에게 조금 안타까운 마음이 든다. 물론 러닝코스트가 상당하기에 팀에서 활용하기 버겁기도 하다. 그 대신 어느 수준을 넘어서면 정말 막강한 힘을 가질 수 있다. 훨씬 효과적인 표현을 사용할 수 있다고 해야하나? 현실적인 장벽(브라우저의 지원 여부등)를 넘어서서 훨씬 생각을 유연하게 가질 수 있으니 더욱 효과적으로 코드를 쓸 수 있지 않을까 싶다.
그리고 플러그인 작성시 느낀건 의외로 테스트 작성할 때랑 추구하는 골이 비슷한듯한 느낌이 든다. 테스트가 어떤 API의 안정성을 결과론적으로 보증한다고 하면 바벨을 활용한 트랜스파일은 원천적인 언어 사용의 패러다임 단에서 보증을 해주니...

그리고 코드를 다시 트랜스파일에 시간이 걸리는 문제도 이미 옛날 얘기이다. webpack을 제대로 활용하면 HMR을 통해 코드를 파일로 만들 필요도 없이, 그리고 앱을 초기화 할 필요도 없이 메모리레벨에서 모듈을 바꿔 넣을 수 있기 떄문에 폭발적인 개발이 가능하다.

## 2017-02-21

주보는 신의 한수였던 듯 하다. 어제 정리해둔 생각을 지금 다시 볼 수 있으니 너무 좋다. 또한, 바로 매일같이 업로드를 하는 것도 아니니 안정감이든다. 오늘은 친구와 만나는 등 좀 여유롭게 지냈다. 아마 이번주는 일본생활 정리등 이것저것 신경써야 할 일이 많으니 그렇게 폭발적인 개발속도를 못낼듯...

### Remark Math

[wooorm/remark#232](https://github.com/wooorm/remark/issues/232)를 반영시키고 테스트를 완성시켰다. 그리고, 웹팩을 통한 데모까지 만들었고 디플로이까지 하였다.

그리고, wooorm씨에게 코드 리뷰를 부탁드렸는데 엄청난 양의 피드백을 받았다. 일단 자고 일어나서 피드백을 반영시켜야겠다.

## 2017-02-22

### Remark Math

#### 렌더러 개선

remark와 remark-html의 관계처럼 remark는 MDAST를 다시 마크다운 스트링으로 돌려주는 기능이 필요하다. 하지만, v0.1.0은 remark-html에 의존하기 때문에 remark-stringify로 MDAST를 다시 마크다운 문자열로 바꾸는게 불가능 하다.

이에 대해 렌더러 플러그인을 분리하는게 어떻겠느냐라는 제안을 받았기에, `remark-math`의 KaTeX를 활용한 HTML로의 렌더링을 전담하는 부분을 분리해서 따로 패키지로 만든다.

단, 관리를 쉽게하기 위해, remark의 저장소처럼 Lerna를 활용하여 monorepo를 구축해서 개발을 하였다.

그리고,

#### Lerna

의외로 쓰기 쉬웠다. 게다가 아직 베타임에도 불구하고 Babel이나, Jest에도 이미 사용되고 있는 만큼 시도해볼만한 가치가 있다.

> 안타까운 점은 Yarn을 쓸 수 없다.

사용법은 CLI를 설치하고 init명령으로 간편하게 초기화가 가능하다.

```
npm i -g lerna
lerna init
```

기본 설정으로 `/packages` 폴더를 서브패키지로 사용한다. 이후 `/packages/remark-math/package.json`와 `/packages/remark-math-katex/package.json`에 의존성만 설정해주면, 다음 명령만으로 간단하게 각각의 서브패키지의 의존성을 받아오는게 가능했다.

```
lerna bootstrap
```

그리고 다음처럼 설정해주면 나중에 관리하기 매우 편해진다.

```
npm i -D lerna
```

그리고 `postinstall`로 자동으로 `lerna bootstrap`을 실행하게 한다.
```
{
  "scripts": {
    "postinstall": "lerna bootstrap"
  }
}
```

### Jus

피드백이 나왔다. 마크다운 프로세서를 바꿀 수 있게 하는건 긍정적이라고 한다.
일단 package.json을 읽어서 플러그인을 자동사용 가능하게 해야겠다.

## 2017-02-23

### Remark Math

딱히, 한일이 없다. 일단 [Rokt33r/remark-math#4](https://github.com/Rokt33r/remark-math/issues/4)로 피어 디펜던시관계의 플러그인의 API가 바뀌기 때문에 이를 기다려야 할 듯 하다.

## 2017-02-24

귀국정리랑 학교 논문 제본판 제출을 위한 잡무때문에 일을 영 하지 못했다.

### Remark Math

우선, [syntax-tree/mdast-util-to-hast#12](https://github.com/syntax-tree/mdast-util-to-hast/pull/12)로 PR을 보냈다. 아마 실제 작업이 들어가기 까진, `mdast-util-to-hast`를 퍼블리시하고, `remark-html`까지 업데이트되어야 할 것이다.

그리고 커버리지 체크가 상당히 정밀했다. 클론된 패키지에서의 커버리지 테스트는 문제없었는데, Codecov는 정말로 조건문 하나씩 체크를 하는 듯 했다. 덕분에 모든 경우의 수에 대해 테스트를 추가해야만 했다.

## 2017-02-25

오늘도 영 크게 일을 처리하지 못했다. 아마 귀국전까진 그다지 여유가 없을 듯하다. 대충 귀국일은 3월2일정도가 되지않을까 싶다.

### RemarkMath

[syntax-tree/mdast-util-to-hast#12](https://github.com/syntax-tree/mdast-util-to-hast/pull/12)가 드디어 처리되었다. 최종 작업은 다음 주 중으로 처리해야겠다.

[woorm]: https://github.com/wooorm
[xo]: https://github.com/sindresorhus/xo
[vscode-remark]: https://github.com/mrmlnc/vscode-remark
[marky-markdown]: https://github.com/npm/marky-markdown
[jus]: http://jus.js.org
[zeke]: https://github.com/zeke
